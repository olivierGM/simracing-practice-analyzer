<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Timezone</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .result { background: #f0f0f0; padding: 10px; margin: 10px 0; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
    </style>
</head>
<body>
    <h1>üîç Debug Timezone Calculation</h1>
    
    <div class="debug-section">
        <h2>Donn√©es de test</h2>
        <p><strong>Derni√®re session serveur:</strong> 12:31 UTC</p>
        <p><strong>Conversion EAST:</strong> 12:31 + 2h30 = 15:01 EAST</p>
        <p><strong>Maintenant (ESTIM√â):</strong> ~17:00 EAST</p>
        <p><strong>Diff√©rence attendue:</strong> ~2h</p>
        <p><strong>Affichage actuel:</strong> "Il y a 9h" ‚ùå</p>
    </div>
    
    <div class="debug-section">
        <h2>Test de conversion</h2>
        <div id="test-results"></div>
        <button onclick="runTimezoneTest()">üß™ Tester la conversion</button>
    </div>
    
    <div class="debug-section">
        <h2>Simulation avec donn√©es r√©elles</h2>
        <div id="simulation-results"></div>
        <button onclick="runSimulation()">üéØ Simuler avec donn√©es r√©elles</button>
    </div>

    <script>
        // Fonction de test de timezone
        function runTimezoneTest() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<div class="result">üß™ Test en cours...</div>';
            
            try {
                // Simuler une session √† 12:31 UTC
                const serverTime = new Date('2024-01-15T12:31:00Z'); // UTC
                console.log('üïê Heure serveur (UTC):', serverTime.toISOString());
                
                // Conversion EAST (UTC + 2h30)
                const eastTime = new Date(serverTime.getTime() + (2.5 * 60 * 60 * 1000));
                console.log('üïê Heure EAST:', eastTime.toISOString());
                
                // Maintenant (simul√© √† 17:00 EAST)
                const now = new Date('2024-01-15T17:00:00');
                console.log('üïê Maintenant (simul√©):', now.toISOString());
                
                // Diff√©rence
                const diffMs = now.getTime() - eastTime.getTime();
                const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
                const diffMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
                
                console.log('üìä Diff√©rence calcul√©e:', diffHours + 'h' + diffMinutes + 'min');
                
                resultsDiv.innerHTML = `
                    <div class="result success">
                        <h3>‚úÖ R√©sultats du test:</h3>
                        <p><strong>Heure serveur (UTC):</strong> ${serverTime.toISOString()}</p>
                        <p><strong>Heure EAST:</strong> ${eastTime.toISOString()}</p>
                        <p><strong>Maintenant (simul√©):</strong> ${now.toISOString()}</p>
                        <p><strong>Diff√©rence calcul√©e:</strong> ${diffHours}h${diffMinutes}min</p>
                        <p><strong>Attendu:</strong> ~2h ‚úÖ</p>
                    </div>
                `;
                
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="result error">
                        <h3>‚ùå Erreur:</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Simulation avec donn√©es r√©elles
        function runSimulation() {
            const simDiv = document.getElementById('simulation-results');
            simDiv.innerHTML = '<div class="result">üéØ Simulation en cours...</div>';
            
            try {
                // Simuler le parsing d'un nom de fichier comme "251015_123100_FP"
                const fileName = "251015_123100_FP"; // 25 Oct 15, 12:31:00
                
                // Extraire les composants
                const dateStr = fileName.substring(0, 6); // 251015
                const timeStr = fileName.substring(7, 13); // 123100
                
                const year = "20" + dateStr.substring(0, 2); // 2025
                const month = dateStr.substring(2, 4); // 10
                const day = dateStr.substring(4, 6); // 15
                const hour = timeStr.substring(0, 2); // 12
                const minute = timeStr.substring(2, 4); // 31
                const second = timeStr.substring(4, 6); // 00
                
                console.log('üìÅ Fichier simul√©:', fileName);
                console.log('üìÖ Composants:', { year, month, day, hour, minute, second });
                
                // Cr√©er la date locale (comme dans notre code)
                const localDate = new Date(parseInt(year), parseInt(month) - 1, parseInt(day), parseInt(hour), parseInt(minute), parseInt(second));
                console.log('üïê Date locale cr√©√©e:', localDate.toISOString());
                
                // Convertir de EAST vers UTC (soustraire 2h30)
                const utcDate = new Date(localDate.getTime() - (2.5 * 60 * 60 * 1000));
                console.log('üïê Date UTC convertie:', utcDate.toISOString());
                
                // Simuler maintenant
                const now = new Date();
                console.log('üïê Maintenant:', now.toISOString());
                
                // Calculer la diff√©rence
                const diffMs = now.getTime() - utcDate.getTime();
                const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
                const diffMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
                
                console.log('üìä Diff√©rence finale:', diffHours + 'h' + diffMinutes + 'min');
                
                simDiv.innerHTML = `
                    <div class="result success">
                        <h3>üéØ R√©sultats de la simulation:</h3>
                        <p><strong>Fichier:</strong> ${fileName}</p>
                        <p><strong>Date locale cr√©√©e:</strong> ${localDate.toISOString()}</p>
                        <p><strong>Date UTC convertie:</strong> ${utcDate.toISOString()}</p>
                        <p><strong>Maintenant:</strong> ${now.toISOString()}</p>
                        <p><strong>Diff√©rence calcul√©e:</strong> ${diffHours}h${diffMinutes}min</p>
                        <p><strong>Probl√®me potentiel:</strong> ${diffHours > 5 ? '‚ùå Trop √©lev√©' : '‚úÖ OK'}</p>
                    </div>
                `;
                
            } catch (error) {
                simDiv.innerHTML = `
                    <div class="result error">
                        <h3>‚ùå Erreur de simulation:</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Auto-run au chargement
        window.addEventListener('load', () => {
            console.log('üöÄ Page de debug charg√©e');
            runTimezoneTest();
            setTimeout(runSimulation, 1000);
        });
    </script>
</body>
</html>
