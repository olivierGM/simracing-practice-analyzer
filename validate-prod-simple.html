<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validation Production - Timezone Fix</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .validation-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .result { background: #f0f0f0; padding: 10px; margin: 10px 0; }
        .success { background: #e8f5e8; color: #2e7d32; }
        .error { background: #ffebee; color: #c62828; }
        .warning { background: #fff3e0; color: #ef6c00; }
        .console-output { background: #000; color: #0f0; padding: 10px; font-family: monospace; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>üîç Validation Production - Correction Timezone</h1>
    
    <div class="validation-section">
        <h2>üìä Test de l'application en production</h2>
        <div id="prod-test-results"></div>
        <button onclick="testProduction()">üöÄ Tester l'application en production</button>
    </div>
    
    <div class="validation-section">
        <h2>üìù Console Output</h2>
        <div id="console-output" class="console-output"></div>
        <button onclick="clearConsole()">üóëÔ∏è Effacer</button>
    </div>

    <script>
        let consoleOutput = '';
        
        function logToOutput(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            consoleOutput += `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
            document.getElementById('console-output').textContent = consoleOutput;
        }
        
        function clearConsole() {
            consoleOutput = '';
            document.getElementById('console-output').textContent = '';
        }
        
        async function testProduction() {
            logToOutput('üöÄ D√©but du test de validation production');
            
            try {
                // Ouvrir l'application en production dans un iframe pour √©viter les CORS
                const iframe = document.createElement('iframe');
                iframe.src = 'https://simracing-practice-analyzer.web.app';
                iframe.style.width = '100%';
                iframe.style.height = '600px';
                iframe.style.border = '1px solid #ccc';
                
                // Cr√©er un conteneur pour l'iframe
                const container = document.createElement('div');
                container.appendChild(iframe);
                document.getElementById('prod-test-results').appendChild(container);
                
                logToOutput('üåê Iframe charg√© avec l\'application en production');
                
                // Attendre que l'iframe se charge
                iframe.onload = () => {
                    logToOutput('‚úÖ Iframe charg√© avec succ√®s');
                    
                    try {
                        // Essayer d'acc√©der au contenu de l'iframe
                        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                        
                        // Chercher l'indicateur de derni√®re session
                        const updateIndicator = iframeDoc.querySelector('.last-update-indicator .update-date');
                        
                        if (updateIndicator) {
                            const updateText = updateIndicator.textContent;
                            logToOutput(`üìÖ Texte affich√©: "${updateText}"`);
                            
                            // Analyser le r√©sultat
                            const timeMatch = updateText.match(/(\d+)h/);
                            if (timeMatch) {
                                const hours = parseInt(timeMatch[1]);
                                logToOutput(`üìä Heures d√©tect√©es: ${hours}h`);
                                
                                if (hours > 10) {
                                    logToOutput('‚ùå √âCHEC: Trop d\'heures d√©tect√©es (>10h)', 'error');
                                    document.getElementById('prod-test-results').innerHTML += `
                                        <div class="result error">
                                            <h3>‚ùå VALIDATION √âCHOU√âE</h3>
                                            <p><strong>Probl√®me:</strong> ${hours}h d√©tect√©es - La correction timezone n'a pas fonctionn√©</p>
                                            <p><strong>Texte affich√©:</strong> "${updateText}"</p>
                                        </div>
                                    `;
                                } else if (hours < 5) {
                                    logToOutput('‚úÖ SUCC√àS: Nombre d\'heures raisonnable (<5h)', 'log');
                                    document.getElementById('prod-test-results').innerHTML += `
                                        <div class="result success">
                                            <h3>‚úÖ VALIDATION R√âUSSIE</h3>
                                            <p><strong>Succ√®s:</strong> ${hours}h d√©tect√©es - La correction timezone fonctionne</p>
                                            <p><strong>Texte affich√©:</strong> "${updateText}"</p>
                                        </div>
                                    `;
                                } else {
                                    logToOutput('‚ö†Ô∏è QUESTIONNABLE: Nombre d\'heures moyen (5-10h)', 'warn');
                                    document.getElementById('prod-test-results').innerHTML += `
                                        <div class="result warning">
                                            <h3>‚ö†Ô∏è VALIDATION QUESTIONNABLE</h3>
                                            <p><strong>Attention:</strong> ${hours}h d√©tect√©es - V√©rification manuelle n√©cessaire</p>
                                            <p><strong>Texte affich√©:</strong> "${updateText}"</p>
                                        </div>
                                    `;
                                }
                            } else {
                                logToOutput('‚ö†Ô∏è Aucun nombre d\'heures d√©tect√©', 'warn');
                            }
                        } else {
                            logToOutput('‚ùå Indicateur de derni√®re session non trouv√©', 'error');
                        }
                    } catch (error) {
                        logToOutput(`‚ùå Erreur d'acc√®s iframe: ${error.message}`, 'error');
                        
                        // Alternative: utiliser une approche diff√©rente
                        logToOutput('üîÑ Tentative d\'approche alternative...');
                        
                        // Cr√©er un lien vers l'application pour test manuel
                        document.getElementById('prod-test-results').innerHTML += `
                            <div class="result warning">
                                <h3>üîó Test manuel n√©cessaire</h3>
                                <p>L'acc√®s iframe a √©chou√©. Veuillez tester manuellement :</p>
                                <p><a href="https://simracing-practice-analyzer.web.app" target="_blank">üåê Ouvrir l'application en production</a></p>
                                <p><strong>Instructions:</strong></p>
                                <ul>
                                    <li>Ouvrir la console (F12)</li>
                                    <li>Regarder l'indicateur "Derni√®re session :"</li>
                                    <li>V√©rifier que le temps affich√© est raisonnable (<5h)</li>
                                </ul>
                            </div>
                        `;
                    }
                };
                
            } catch (error) {
                logToOutput(`‚ùå Erreur lors du test: ${error.message}`, 'error');
            }
        }
        
        // Auto-run au chargement
        window.addEventListener('load', () => {
            logToOutput('üöÄ Page de validation charg√©e');
            logToOutput('üìã Cliquez sur "Tester l\'application en production" pour commencer');
        });
    </script>
</body>
</html>
